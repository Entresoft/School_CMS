V/** @jsx React.DOM */\u000a\u000aSC.AnnouncePage = React.createClass({displayName: 'AnnouncePage',\u000a  render: function() {\u000a    return (\u000a      React.createElement(RB.Grid, null, \u000a        React.createElement(RB.PageHeader, null, this.props.ann.title, \u000a          React.createElement("small", null, " by \u8a2d\u5099\u7d44\u2027\u7d44\u9577")\u000a        ), \u000a        React.createElement(RB.Row, null, React.createElement(RB.Col, {xs: 12, md: 12}, React.createElement(RB.Well, null, \u000a          React.createElement("span", {dangerouslySetInnerHTML: {__html: marked(this.props.ann.content, {sanitize: true,breaks:true})}})\u000a        ))), \u000a        React.createElement(RB.Row, null, \u000a          React.createElement(RB.Col, {xs: 12, md: 6}, React.createElement(RB.Well, null, \u000a            React.createElement("h4", null, "\u9644\u4ef6"), React.createElement("hr", null), \u000a            React.createElement(SC.AttachmentPanel, {attlist: this.props.attlist})\u000a          )), \u000a          React.createElement(RB.Col, {xs: 12, md: 6}, React.createElement(RB.Well, null, \u000a            React.createElement("h4", null, "\u6642\u9593"), React.createElement("hr", null), \u000a            React.createElement("p", null, "\u767c\u5e03\u65bc\uff1a", this.props.ann.created), \u000a            React.createElement("p", null, "\u6700\u5f8c\u66f4\u65b0\uff1a", this.props.ann.updated)\u000a          ))\u000a        ), \u000a        React.createElement(RB.Row, null, \u000a          React.createElement(RB.Col, {xs: 12, md: 2}, \u000a            React.createElement("a", {className: "btn btn-warning btn-xs btn-block", href: '/announce/edit/'+this.props.ann.id}, "\u7de8\u8f2f")\u000a          ), \u000a          React.createElement(RB.Col, {xs: 12, md: 2}, \u000a            React.createElement("a", {className: "btn btn-primary btn-xs btn-block", href: "/announce/"}, "\u8fd4\u56de")\u000a          )\u000a        )\u000a      )\u000a    );\u000a  }\u000a});\u000a\u000a\u000a{/*ICON: http://www.webiconset.com/file-type-icons/*/}\u000aSC.AttachmentPanel = React.createClass({displayName: 'AttachmentPanel',\u000a  _icon: ['aac','ai','aiff','asp','avi','bmp','c','cpp','css','dat','dmg','doc','docx',\u000a      'dot','dotx','dwg','dxf','eps','exe','flv','gif','h','html','ics','iso','java',\u000a      'jpg','key','m4v','mid','mov','mp3','mp4','mpg','odp','ods','odt','otp','ots',\u000a      'ott','pdf','php','png','pps','ppt','pptx','psd','py','qt','rar','rb','rtf','sql',\u000a      'tga','tgz','tiff','txt','wav','xls','xlsx','xml','yml','zip'],\u000a  _ms_office: ['docx','doc','dot','dotx','xlsx','xlsb','xls','xlsm','pptx','ppsx','ppt',\u000a      'pps','pptm','potm','ppam','potx','ppsm'],\u000a  openlink: function(att){\u000a    if(this._ms_office.indexOf(att.filetype)>=0){\u000a      return React.createElement("a", {target: "_blank", href: 'https://view.officeapps.live.com/op/view.aspx?src='+encodeURIComponent(window.location.host+'/file/'+att.path)}, "\u958b\u555f")\u000a    }else if(att.filetype!=='file'){\u000a      return React.createElement("a", {target: "_blank", href: '/file/'+att.path}, "\u958b\u555f")\u000a    }\u000a  },\u000a  render: function() {\u000a    var attItems = this.props.attlist.map(function (att) {\u000a      if(this._icon.indexOf(att.filetype)<0){\u000a        att.filetype = 'file';\u000a      }\u000a      return (\u000a        React.createElement("div", {key: att.key, className: "media"}, \u000a          React.createElement("div", {className: "media-left"}, React.createElement("img", {src: '/static/icon/'+att.filetype+'.png', alt: att.filetype})), \u000a          React.createElement("div", {className: "media-body"}, \u000a            React.createElement("div", {className: "media-heading"}, att.filename), \u000a            React.createElement("div", null, \u000a              this.openlink(att), \u000a              React.createElement("a", {href: '/file/'+att.path+'?download=1'}, "\u4e0b\u8f09")\u000a            )\u000a          )\u000a        )\u000a      );\u000a    }.bind(this));\u000a    if( this.props.attlist.length ){\u000a      return React.createElement("div", null, attItems);\u000a    }else{\u000a      return React.createElement("p", null, "\u6c92\u6709\u9644\u4ef6");\u000a    }\u000a  },\u000a});\u000a\u000a\u000aSC.EditAnnPage = React.createClass({displayName: 'EditAnnPage',\u000a  mixins: [React.addons.LinkedStateMixin],\u000a  getInitialState: function() {\u000a    return {\u000a      title: this.props.ann.title,\u000a      content: this.props.ann.content,\u000a    };\u000a  },\u000a  render: function() {\u000a    return (\u000a      React.createElement(RB.Grid, null, \u000a        React.createElement(RB.PageHeader, null, "\u7de8\u8f2f\u516c\u544a"), \u000a        React.createElement("form", {action: '/announce/edit/'+this.props.ann.id, method: "POST"}, \u000a          React.createElement(RB.Row, null, \u000a            React.createElement(RB.Col, {xs: 12, md: 6}, \u000a              React.createElement(RB.Well, null, \u000a                React.createElement(RB.Input, {type: "hidden", name: "_xsrf", value: this.props._xsrf_token}), \u000a                React.createElement(RB.Input, {type: "text", name: "title", valueLink: this.linkState('title'), label: "\u516c\u544a\u6a19\u984c", placeholder: "\u8f38\u5165\u516c\u544a\u6a19\u984c"}), \u000a                React.createElement(SC.ResizeTextArea, {name: "content", valueLink: this.linkState('content'), label: "\u516c\u544a\u5167\u5bb9", placeholder: "\u8f38\u5165\u516c\u544a\u5167\u5bb9"})\u000a              ), \u000a              React.createElement(RB.Well, null, \u000a                React.createElement("h4", null, "\u7de8\u8f2f\u9644\u4ef6"), React.createElement("hr", null), \u000a                React.createElement(SC.EditAttPanel, {attlist: this.props.attlist, tmpatts: this.props.tmpatts, _xsrf_token: this.props._xsrf_token})\u000a              )\u000a            ), \u000a            React.createElement(RB.Col, {xs: 12, md: 6}, React.createElement(RB.Well, null, \u000a              React.createElement("h4", null, "\u9810\u89bd\u5167\u5bb9"), React.createElement("hr", null), \u000a              React.createElement("span", {dangerouslySetInnerHTML: {__html: marked(this.state.content, {sanitize: true,breaks:true})}})\u000a            ))\u000a          ), \u000a          React.createElement(RB.Row, null, \u000a            React.createElement(RB.Col, {xs: 12, md: 2}, \u000a              React.createElement(RB.Button, {bsStyle: "success", bsSize: "xsmall", block: true, type: "submit"}, "\u78ba\u5b9a")\u000a            ), \u000a            React.createElement(RB.Col, {xs: 12, md: 2}, \u000a              React.createElement("a", {className: "btn btn-primary btn-xs btn-block", href: '/announce/'+this.props.ann.id}, "\u8fd4\u56de")\u000a            )\u000a          )\u000a          \u000a        )\u000a      )\u000a    );\u000a  }\u000a});\u000a\u000a\u000aSC.EditAttPanel = React.createClass({displayName: 'EditAttPanel',\u000a  getInitialState: function() {\u000a    return {\u000a      tmpatts: this.props.tmpatts,\u000a      attlist: this.props.attlist,\u000a    };\u000a  },\u000a  handleChange: function(file){\u000a    tmpatts = this.state.tmpatts;\u000a    tmpatts.push(file);\u000a    this.setState({\u000a      tmpatts: tmpatts,\u000a    });\u000a  },\u000a  handleDelete: function(att, upload){\u000a    if(upload){\u000a      tmpatts = this.state.tmpatts;\u000a      tmpatts.splice(tmpatts.indexOf(att),1);\u000a      this.setState({\u000a        tmpatts:tmpatts,\u000a      });\u000a    }else{\u000a      attlist = this.state.attlist;\u000a      attlist.splice(attlist.indexOf(att),1);\u000a      this.setState({\u000a        attlist:attlist,\u000a      });\u000a    }\u000a  },\u000a  render: function() {\u000a    var uploadedatts = this.state.attlist.map(function (att) {\u000a      return React.createElement(SC.DeleteAttComponent, {key: att.key, att: att, handleDelete: this.handleDelete, _xsrf_token: this.props._xsrf_token})\u000a    }.bind(this));\u000a    var atts = this.state.tmpatts.map(function (att) {\u000a      return React.createElement(SC.DeleteAttComponent, {key: att.key, att: att, handleDelete: this.handleDelete, upload: true, _xsrf_token: this.props._xsrf_token})\u000a    }.bind(this)); \u000a    return (\u000a      React.createElement("div", null, \u000a        uploadedatts, \u000a        atts, \u000a        React.createElement(SC.UploadAttBox, {_xsrf_token: this.props._xsrf_token, newUpload: this.handleChange})\u000a      )\u000a    );\u000a  }\u000a});\u000a\u000a\u000aSC.DeleteAttComponent = React.createClass({displayName: 'DeleteAttComponent',\u000a  uploadfile: function(){\u000a    if(this.props.upload){\u000a      return React.createElement(RB.Input, {key: 0, type: "hidden", name: "attachment", value: this.props.att.key});\u000a    }\u000a  },\u000a  deleteAtt: function(){\u000a    if(!confirm('\u4f60\u78ba\u5b9a\u8981\u522a\u9664 '+this.props.att.filename+' \u55ce?'))return;\u000a    xhr = new XMLHttpRequest();\u000a    form = new FormData();\u000a    form.append('_xsrf', this.props._xsrf_token);\u000a    path = this.props.upload?'/fileupload/':'/file/';\u000a    path+=this.props.att.key;\u000a    xhr.open('DELETE',path,true);\u000a    xhr.onreadystatechange = function(){\u000a      if(xhr.readyState==4&&xhr.status==200){\u000a        console.log(xhr.responseText);\u000a        this.props.handleDelete(this.props.att,this.props.upload);\u000a      }\u000a    }.bind(this);\u000a    xhr.send(form);\u000a  },\u000a  render: function() {\u000a    return (\u000a      React.createElement(RB.Panel, {key: this.props.key}, \u000a        React.createElement(RB.Row, null, \u000a          React.createElement(RB.Col, {xs: 10, md: 10}, \u000a            React.createElement("span", {className: "glyphicon glyphicon-file", 'aria-hidden': "true"}), \u000a            React.createElement("span", {className: "hideOverflow"}, this.props.att.filename.substring(0,50))\u000a          ), \u000a          React.createElement(RB.Col, {xs: 2, md: 2}, \u000a            React.createElement(RB.Button, {onClick: this.deleteAtt, bsStyle: "danger"}, "\u522a\u9664"), \u000a            this.uploadfile()\u000a          )\u000a        )\u000a      )\u000a    );\u000a  }\u000a});\u000a\u000a\u000aSC.UploadAttBox = React.createClass({displayName: 'UploadAttBox',\u000a  getInitialState: function() {\u000a    return {\u000a      file: '',\u000a      filelist: {},\u000a    };\u000a  },\u000a  handleChange: function(evt) {\u000a    file = evt.target.files[0];\u000a    form = new FormData();\u000a    xhr = new XMLHttpRequest();\u000a    uuid = new Date().getTime();\u000a\u000a    filelist = this.state.filelist;\u000a    filelist[uuid] = {\u000a      percent: 0.0,\u000a      filename: file.name,\u000a    };\u000a    this.setState({\u000a      filelist:filelist,\u000a      file: '',\u000a    });\u000a\u000a    form.append('file',file);\u000a    form.append('_xsrf',this.props._xsrf_token);\u000a    xhr.open('POST','/fileupload',true);\u000a    xhr.onreadystatechange = function(){\u000a      if(xhr.readyState==4&&xhr.status==200){\u000a        console.log(xhr.responseText);\u000a        attfile = JSON.parse(xhr.responseText);\u000a        this.props.newUpload({\u000a          'filename': attfile.file_name,\u000a          'key': attfile.key,\u000a        });\u000a        filelist = this.state.filelist;\u000a        delete filelist[uuid];\u000a        this.setState({\u000a          filelist: filelist,\u000a        })\u000a      }\u000a    }.bind(this);\u000a    xhr.upload.onprogress = function(e){\u000a      if(e.lengthComputable){\u000a          filelist = this.state.filelist;\u000a          filelist[uuid].percent = e.loaded*100 / e.total;\u000a          this.setState({filelist: filelist});\u000a      }\u000a    }.bind(this);\u000a    xhr.send(form);\u000a  },\u000a  progressBar: function (uuid){\u000a    return (\u000a      React.createElement(RB.Panel, {key: uuid}, \u000a        React.createElement("span", {className: "glyphicon glyphicon-file", 'aria-hidden': "true"}), \u000a        this.state.filelist[uuid].filename, \u000a        React.createElement(RB.ProgressBar, {active: true, now: this.state.filelist[uuid].percent, label: "%(percent)s%"})\u000a      )\u000a    )\u000a  },\u000a  render: function() {\u000a    var uploading = [];\u000a    for (var i in this.state.filelist){\u000a      uploading.push(this.progressBar(i));\u000a    }\u000a    return (\u000a      React.createElement("div", null, \u000a        uploading, \u000a        React.createElement(RB.Input, {type: "file", ref: "file", value: this.state.file, onChange: this.handleChange})\u000a      )\u000a    );\u000a  }\u000a});\u000a
p1
.