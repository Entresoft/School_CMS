Vconst RB=ReactBootstrap;const RMR=ReactMiniRouter;var Alert=RB.Alert;var SC={}\u000aSC.makeURL=function(path,query){var q=[];for(var key in query){q.push(encodeURIComponent(key)+'='+encodeURIComponent(query[key]));}\u000areturn path+'?'+(q.join('&'));}\u000aSC.GroupPage=React.createClass({displayName:'GroupPage',render:function(){var group_tag=this.props.groups.map(function(group){return(React.createElement(RB.Label,{key:group.id,bsStyle:"primary"},group.name));});return(React.createElement(RB.Grid,null,React.createElement(RB.Row,null,React.createElement(RB.Col,null,React.createElement(RB.Well,null,React.createElement("h3",null,"\u7fa4\u7d44"),React.createElement("hr",null),group_tag)))));}});SC.LoginForm=React.createClass({displayName:'LoginForm',mixins:[React.addons.LinkedStateMixin],getInitialState:function(){return{_xsrf_token:this.props._xsrf_token,account:this.props.account,};},render:function(){return(React.createElement("form",{action:"/login",method:"POST"},React.createElement(RB.Input,{type:"hidden",name:"_xsrf",value:this.state._xsrf_token}),React.createElement(RB.Input,{type:"text",name:"account",valueLink:this.linkState('account'),placeholder:"\u5e33\u865f"}),React.createElement(RB.Input,{type:"password",name:"passwd",placeholder:"\u5bc6\u78bc"}),React.createElement(RB.Input,{type:"submit",value:"\u767b\u5165"})));},});SC.LoginPage=React.createClass({displayName:'LoginPage',errorMsg:function(){if(this.props.alert.length){return(React.createElement(RB.Alert,{dismiss:true,bsStyle:"danger"},React.createElement("strong",null,"\u767b\u5165\u5931\u6557!")," ",this.props.alert));}},render:function(){return(React.createElement(RB.Grid,null,React.createElement(RB.Col,{xs:12,md:6,mdOffset:3},React.createElement(RB.Well,null,React.createElement("h1",null,"\u767b\u5165"),React.createElement("hr",null),this.errorMsg(),React.createElement(SC.LoginForm,{account:this.props.account,_xsrf_token:this.props._xsrf_token})))));}});SC.LoginModel=React.createClass({displayName:'LoginModel',render:function(){return(React.createElement(RB.Modal,React.__spread({},this.props,{title:"\u767b\u5165",bsStyle:"info",backdrop:true,animation:true}),React.createElement("div",{className:"modal-body"},React.createElement(SC.LoginForm,React.__spread({},this.props)))));}});SC.AnnIndexPage=React.createClass({displayName:'AnnIndexPage',getInitialState:function(){return{annlist:[],search:'',start:0,totle:0,};},componentDidMount:function(){var url='/api'+window.location.pathname+window.location.search;this.props.ajax(url,function(data){this.setState({annlist:data.anns,start:data.start,totle:data.totle});}.bind(this));},handleSearch:function(search){var url=SC.makeURL(window.location.pathname,{'start':this.state.start,'totle':this.state.totle,'search':search,});RMR.navigate(url);},render:function(){var annItems=this.state.annlist.map(function(ann){return(React.createElement("tr",{key:ann.id},React.createElement("td",null,React.createElement("a",{href:'/announce/'+ann.id},ann.title)),React.createElement("td",null,ann.created)));});return(React.createElement("div",null,React.createElement(RB.Grid,null,React.createElement(RB.Row,null,React.createElement(RB.Col,{xs:12,md:6},React.createElement("h1",null,"Announcement"),React.createElement("a",{href:"/announce/edit"},"New Announcement!"),React.createElement(SC.SearchAnnForm,{search:this.state.search,onSearch:this.handleSearch}))),React.createElement(RB.Row,null,React.createElement(RB.Col,{xs:12,md:12},React.createElement(RB.Well,null,React.createElement(RB.Table,{striped:true,bordered:true,hover:true},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"\u6a19\u984c"),React.createElement("th",null,"\u516c\u544a\u6642\u9593"))),React.createElement("tbody",null,annItems))),React.createElement(SC.Pager,{start:this.state.start,totle:this.state.totle}))))));}});SC.SearchAnnForm=React.createClass({displayName:'SearchAnnForm',mixins:[React.addons.LinkedStateMixin],getInitialState:function(){return{search:this.props.search,};},handleClick:function(){this.props.onSearch(this.state.search);},render:function(){var search_button=(React.createElement(RB.Button,{bsStyle:"primary",className:"btn-flat",onClick:this.handleClick},"\u641c\u5c0b"));return(React.createElement("form",null,React.createElement(RB.Input,{rel:"search",type:"text",name:"search",valueLink:this.linkState('search'),placeholder:"\u641c\u5c0b\u516c\u544a",buttonAfter:search_button})));}})\u000aSC.Pager=React.createClass({displayName:'Pager',pageUrl:function(start){return'/announce?start='+start;},render:function(){var max=function(a,b){return a>b?a:b;};var min=function(a,b){return a<b?a:b;};return(React.createElement(RB.Pager,null,React.createElement(RB.PageItem,{previous:true,href:this.pageUrl(max(0,this.props.start-10)),disabled:this.props.start<=0},"\u2190 Previous Page"),React.createElement(RB.PageItem,{next:true,href:this.pageUrl(this.props.start+10),disabled:this.props.start+10>=this.props.totle},"Next Page \u2192")));}});SC.AnnouncePage=React.createClass({displayName:'AnnouncePage',render:function(){return(React.createElement(RB.Grid,null,React.createElement(RB.PageHeader,null,this.props.ann.title,React.createElement("small",null," by \u8a2d\u5099\u7d44\u2027\u7d44\u9577")),React.createElement(RB.Row,null,React.createElement(RB.Col,{xs:12,md:12},React.createElement(RB.Well,null,React.createElement("span",{dangerouslySetInnerHTML:{__html:marked(this.props.ann.content,{sanitize:true,breaks:true})}})))),React.createElement(RB.Row,null,React.createElement(RB.Col,{xs:12,md:6},React.createElement(RB.Well,null,React.createElement("h4",null,"\u9644\u4ef6"),React.createElement("hr",null),React.createElement(SC.AttachmentPanel,{attlist:this.props.attlist}))),React.createElement(RB.Col,{xs:12,md:6},React.createElement(RB.Well,null,React.createElement("h4",null,"\u6642\u9593"),React.createElement("hr",null),React.createElement("p",null,"\u767c\u5e03\u65bc\uff1a",this.props.ann.created),React.createElement("p",null,"\u6700\u5f8c\u66f4\u65b0\uff1a",this.props.ann.updated)))),React.createElement(RB.Row,null,React.createElement(RB.Col,{xs:12,md:2},React.createElement("a",{className:"btn btn-warning btn-xs btn-block",href:'/announce/edit/'+this.props.ann.id},"\u7de8\u8f2f")),React.createElement(RB.Col,{xs:12,md:2},React.createElement("a",{className:"btn btn-primary btn-xs btn-block",href:"/announce/"},"\u8fd4\u56de")))));}});{}\u000aSC.AttachmentPanel=React.createClass({displayName:'AttachmentPanel',_icon:['aac','ai','aiff','asp','avi','bmp','c','cpp','css','dat','dmg','doc','docx','dot','dotx','dwg','dxf','eps','exe','flv','gif','h','html','ics','iso','java','jpg','key','m4v','mid','mov','mp3','mp4','mpg','odp','ods','odt','otp','ots','ott','pdf','php','png','pps','ppt','pptx','psd','py','qt','rar','rb','rtf','sql','tga','tgz','tiff','txt','wav','xls','xlsx','xml','yml','zip'],_ms_office:['docx','doc','dot','dotx','xlsx','xlsb','xls','xlsm','pptx','ppsx','ppt','pps','pptm','potm','ppam','potx','ppsm'],openlink:function(att){if(this._ms_office.indexOf(att.filetype)>=0){return React.createElement("a",{target:"_blank",href:'https://view.officeapps.live.com/op/view.aspx?src='+encodeURIComponent(window.location.host+'/file/'+att.path)},"\u958b\u555f")}else if(att.filetype!=='file'){return React.createElement("a",{target:"_blank",href:'/file/'+att.path},"\u958b\u555f")}},render:function(){var attItems=this.props.attlist.map(function(att){if(this._icon.indexOf(att.filetype)<0){att.filetype='file';}\u000areturn(React.createElement("div",{key:att.key,className:"media"},React.createElement("div",{className:"media-left"},React.createElement("img",{src:'/static/icon/'+att.filetype+'.png',alt:att.filetype})),React.createElement("div",{className:"media-body"},React.createElement("div",{className:"media-heading"},att.filename),React.createElement("div",null,this.openlink(att),React.createElement("a",{href:'/file/'+att.path+'?download=1'},"\u4e0b\u8f09")))));}.bind(this));if(this.props.attlist.length){return React.createElement("div",null,attItems);}else{return React.createElement("p",null,"\u6c92\u6709\u9644\u4ef6");}},});SC.EditAnnPage=React.createClass({displayName:'EditAnnPage',mixins:[React.addons.LinkedStateMixin],getInitialState:function(){return{title:this.props.ann.title,content:this.props.ann.content,};},render:function(){return(React.createElement(RB.Grid,null,React.createElement(RB.PageHeader,null,"\u7de8\u8f2f\u516c\u544a"),React.createElement("form",{action:'/announce/edit/'+this.props.ann.id,method:"POST"},React.createElement(RB.Row,null,React.createElement(RB.Col,{xs:12,md:6},React.createElement(RB.Well,null,React.createElement(RB.Input,{type:"hidden",name:"_xsrf",value:this.props._xsrf_token}),React.createElement(RB.Input,{type:"text",name:"title",valueLink:this.linkState('title'),label:"\u516c\u544a\u6a19\u984c",placeholder:"\u8f38\u5165\u516c\u544a\u6a19\u984c"}),React.createElement(SC.ResizeTextArea,{name:"content",valueLink:this.linkState('content'),label:"\u516c\u544a\u5167\u5bb9",placeholder:"\u8f38\u5165\u516c\u544a\u5167\u5bb9"})),React.createElement(RB.Well,null,React.createElement("h4",null,"\u7de8\u8f2f\u9644\u4ef6"),React.createElement("hr",null),React.createElement(SC.EditAttPanel,{attlist:this.props.attlist,tmpatts:this.props.tmpatts,_xsrf_token:this.props._xsrf_token}))),React.createElement(RB.Col,{xs:12,md:6},React.createElement(RB.Well,null,React.createElement("h4",null,"\u9810\u89bd\u5167\u5bb9"),React.createElement("hr",null),React.createElement("span",{dangerouslySetInnerHTML:{__html:marked(this.state.content,{sanitize:true,breaks:true})}})))),React.createElement(RB.Row,null,React.createElement(RB.Col,{xs:12,md:2},React.createElement(RB.Button,{bsStyle:"success",bsSize:"xsmall",block:true,type:"submit"},"\u78ba\u5b9a")),React.createElement(RB.Col,{xs:12,md:2},React.createElement("a",{className:"btn btn-primary btn-xs btn-block",href:'/announce/'+this.props.ann.id},"\u8fd4\u56de"))))));}});SC.EditAttPanel=React.createClass({displayName:'EditAttPanel',getInitialState:function(){return{tmpatts:this.props.tmpatts,attlist:this.props.attlist,};},handleChange:function(file){tmpatts=this.state.tmpatts;tmpatts.push(file);this.setState({tmpatts:tmpatts,});},handleDelete:function(att,upload){if(upload){tmpatts=this.state.tmpatts;tmpatts.splice(tmpatts.indexOf(att),1);this.setState({tmpatts:tmpatts,});}else{attlist=this.state.attlist;attlist.splice(attlist.indexOf(att),1);this.setState({attlist:attlist,});}},render:function(){var uploadedatts=this.state.attlist.map(function(att){return React.createElement(SC.DeleteAttComponent,{key:att.key,att:att,handleDelete:this.handleDelete,_xsrf_token:this.props._xsrf_token})}.bind(this));var atts=this.state.tmpatts.map(function(att){return React.createElement(SC.DeleteAttComponent,{key:att.key,att:att,handleDelete:this.handleDelete,upload:true,_xsrf_token:this.props._xsrf_token})}.bind(this));return(React.createElement("div",null,uploadedatts,atts,React.createElement(SC.UploadAttBox,{_xsrf_token:this.props._xsrf_token,newUpload:this.handleChange})));}});SC.DeleteAttComponent=React.createClass({displayName:'DeleteAttComponent',uploadfile:function(){if(this.props.upload){return React.createElement(RB.Input,{key:0,type:"hidden",name:"attachment",value:this.props.att.key});}},deleteAtt:function(){if(!confirm('\u4f60\u78ba\u5b9a\u8981\u522a\u9664 '+this.props.att.filename+' \u55ce?'))return;xhr=new XMLHttpRequest();form=new FormData();form.append('_xsrf',this.props._xsrf_token);path=this.props.upload?'/fileupload/':'/file/';path+=this.props.att.key;xhr.open('DELETE',path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){console.log(xhr.responseText);this.props.handleDelete(this.props.att,this.props.upload);}}.bind(this);xhr.send(form);},render:function(){return(React.createElement(RB.Panel,{key:this.props.key},React.createElement(RB.Row,null,React.createElement(RB.Col,{xs:10,md:10},React.createElement("span",{className:"glyphicon glyphicon-file",'aria-hidden':"true"}),React.createElement("span",{className:"hideOverflow"},this.props.att.filename.substring(0,50))),React.createElement(RB.Col,{xs:2,md:2},React.createElement(RB.Button,{onClick:this.deleteAtt,bsStyle:"danger"},"\u522a\u9664"),this.uploadfile()))));}});SC.UploadAttBox=React.createClass({displayName:'UploadAttBox',getInitialState:function(){return{file:'',filelist:{},};},handleChange:function(evt){file=evt.target.files[0];form=new FormData();xhr=new XMLHttpRequest();uuid=new Date().getTime();filelist=this.state.filelist;filelist[uuid]={percent:0.0,filename:file.name,};this.setState({filelist:filelist,file:'',});form.append('file',file);form.append('_xsrf',this.props._xsrf_token);xhr.open('POST','/fileupload',true);xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){console.log(xhr.responseText);attfile=JSON.parse(xhr.responseText);this.props.newUpload({'filename':attfile.file_name,'key':attfile.key,});filelist=this.state.filelist;delete filelist[uuid];this.setState({filelist:filelist,})}}.bind(this);xhr.upload.onprogress=function(e){if(e.lengthComputable){filelist=this.state.filelist;filelist[uuid].percent=e.loaded*100/e.total;this.setState({filelist:filelist});}}.bind(this);xhr.send(form);},progressBar:function(uuid){return(React.createElement(RB.Panel,{key:uuid},React.createElement("span",{className:"glyphicon glyphicon-file",'aria-hidden':"true"}),this.state.filelist[uuid].filename,React.createElement(RB.ProgressBar,{active:true,now:this.state.filelist[uuid].percent,label:"%(percent)s%"})))},render:function(){var uploading=[];for(var i in this.state.filelist){uploading.push(this.progressBar(i));}\u000areturn(React.createElement("div",null,uploading,React.createElement(RB.Input,{type:"file",ref:"file",value:this.state.file,onChange:this.handleChange})));}});SC.App=React.createClass({displayName:'App',mixins:[RMR.RouterMixin],routes:{'/':'indexHandler','/login':'loginHandler','/logout':'logoutHandler','/admin/adduser':'adduserHandler','/announce':'annIndexHandler','/announce/:annid':'announceHandler','/announce/edit/:annid':'editAnnHandler','/group':'groupHandler','/grouplist':'groupListHandler',},ajax:function(url,callback){console.log('AJAX TO URL:'+url);var xhr=new XMLHttpRequest();xhr.open('GET',url,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status){this.setState({status:xhr.status});}\u000athis.setState({loading:-1});if(xhr.status==200){callback(JSON.parse(xhr.response));}}}.bind(this);xhr.upload.onprogress=function(e){console.log(e.lengthComputable);if(e.lengthComputable){console.log('AJAX:'+e.loaded*100/e.total+'%');this.setState({loading:e.loaded*100/e.total});}}.bind(this);xhr.onerror=function(){this.setState({status:500});};xhr.send();},getInitialState:function(){return{loading:-1,status:200,};},componentDidMount:function(){$.material.init();},render:function(){var getPage=function(){if(this.state.status==200){return this.renderCurrentRoute();}else{return React.createElement("h1",null,"Geez, ",this.state.status);}}.bind(this);return(React.createElement("div",null,React.createElement(RB.ProgressBar,{now:this.state.loading,bsStyle:"info",style:{position:'fixed',top:'0px',height:'4px',width:'100%'}}),React.createElement(SC.NavbarInstance,{loginpage:_data.loginpage,current_user:_data.current_user,_xsrf_token:_data._xsrf_token}),getPage()));},indexHandler:function(){return React.createElement("div",null,"Hello World");},loginHandler:function(){return React.createElement(SC.LoginPage,null);},logoutHandler:function(){return React.createElement(SC.LoginPage,null);},adduserHandler:function(){return React.createElement(SC.LoginPage,null);},annIndexHandler:function(){return React.createElement(SC.AnnIndexPage,{ajax:this.ajax});},announceHandler:function(){return React.createElement(SC.LoginPage,null);},editAnnHandler:function(){return React.createElement(SC.LoginPage,null);},groupHandler:function(){return React.createElement(SC.LoginPage,null);},groupListHandler:function(){return React.createElement(SC.LoginPage,null);},notFound:function(path){return React.createElement("div",{className:"not-found"},"Page Not Found: ",path);}});SC.NavbarInstance=React.createClass({displayName:'NavbarInstance',userSign:function(){if(this.props.current_user){return(React.createElement(RB.DropdownButton,{eventKey:1,title:this.props.current_user.name},React.createElement(RB.MenuItem,{eventKey:"1"},"Action"),React.createElement(RB.MenuItem,{eventKey:"2"},"Another action"),React.createElement(RB.MenuItem,{eventKey:"3"},"Something else here"),React.createElement(RB.MenuItem,{divider:true}),React.createElement(RB.MenuItem,{eventKey:"4",href:"/logout"},"Logout")))}else if(!this.props.loginpage){return(React.createElement(RB.ModalTrigger,{modal:React.createElement(SC.LoginModel,{_xsrf_token:this.props._xsrf_token})},React.createElement(RB.NavItem,{eventKey:1},"Login")));}},render:function(){return(React.createElement(RB.Navbar,{brand:React.createElement("a",{href:"/"},"School Cms"),inverse:true,toggleNavKey:0},React.createElement(RB.Nav,{right:true,eventKey:0}," ",this.userSign())));},});SC.ResizeTextArea=React.createClass({displayName:'ResizeTextArea',getInitialState:function(){return{'value':this.props.value,}},textareaResize:function(){var textarea=React.findDOMNode(this.refs.textarea).getElementsByTagName('textarea')[0];textarea.style.height='0px'\u000atextarea.style.height=textarea.scrollHeight+20+'px';if(this.props.onChange){this.props.onChange();}else if(this.props.valueLink){this.props.valueLink.requestChange(this.refs.textarea.getValue());}},getValue:function(){return this.refs.textarea.getValue();},render:function(){var out=['valueLink','onChange','type','ref'];var other={};for(var key in this.props){if(out.indexOf(key)===-1){other[key]=this.props[key];}}\u000aother.className=(other.className?other.className:'')+'resizetextarea';return(React.createElement(RB.Input,React.__spread({},other,{type:"textarea",ref:"textarea",onChange:this.textareaResize,value:this.state.value})));}});
p1
.